/**
 * Rashi Prediction Calculator
 * Matches Python's general.py prediction logic
 * Provides predictions based on planet positions in houses relative to each Rashi as Lagna
 */

import type { GrahaRashiInfo } from './RashiChart';

export type PredictionMode = 'singleWord' | 'fullMessage';

export interface RashiPredictionResult {
  rashi: number; // 0-11 (Mesha to Meena)
  rashiName: string;
  prediction: string; // Single word or full message based on mode
  planets: Array<{
    planet: string;
    house: number; // Relative house from this rashi
    keyword?: string; // For single word mode
    message?: string; // For full message mode
  }>;
}

// Telugu Rashi names
const RASHI_NAMES_TE = [
  'మేష',
  'వృషభ',
  'మిథున',
  'కర్క',
  'సింహ',
  'కన్య',
  'తులా',
  'వృశ్చిక',
  'ధనుస్సు',
  'మకర',
  'కుంభ',
  'మీన',
];

// Planet names matching Python's order [Sun, Moon, Mars, Mercury, Jupiter, Venus, Saturn, Rahu, Ketu]
const PLANET_NAMES = [
  'Sun',
  'Moon',
  'Mars',
  'Mercury',
  'Jupiter',
  'Venus',
  'Saturn',
  'Rahu',
  'Ketu',
];
const PLANET_NAMES_TE = ['సూర్య', 'చంద్ర', 'కుజ', 'బుధ', 'గురు', 'శుక్ర', 'శని', 'రాహు', 'కేతు'];

/**
 * Single-word keywords for each planet in each house (1-12)
 * Based on traditional Vedic astrology principles
 */
const PLANET_HOUSE_KEYWORDS: Record<number, Record<number, string>> = {
  // Sun in houses 1-12
  0: {
    1: 'నాయకత్వం',
    2: 'ధనలాభం',
    3: 'ధైర్యం',
    4: 'స్థిరత్వం',
    5: 'విజయం',
    6: 'శత్రుజయం',
    7: 'వ్యాపారం',
    8: 'సవాళ్లు',
    9: 'అదృష్టం',
    10: 'కీర్తి',
    11: 'లాభం',
    12: 'ప్రయాణం',
  },
  // Moon in houses 1-12
  1: {
    1: 'శాంతి',
    2: 'సంపద',
    3: 'సాహసం',
    4: 'ఆనందం',
    5: 'సంతానం',
    6: 'తల్లి',
    7: 'భార్య',
    8: 'మానసికం',
    9: 'భక్తి',
    10: 'ప్రజ్ఞ',
    11: 'స్నేహం',
    12: 'విశ్రాంతి',
  },
  // Mars in houses 1-12
  2: {
    1: 'శక్తి',
    2: 'వాదం',
    3: 'విజయం',
    4: 'భూమి',
    5: 'పిల్లలు',
    6: 'యుద్ధం',
    7: 'వివాదం',
    8: 'ప్రమాదం',
    9: 'ధర్మం',
    10: 'కర్మ',
    11: 'సోదరులు',
    12: 'ఖర్చు',
  },
  // Mercury in houses 1-12
  3: {
    1: 'బుద్ధి',
    2: 'వాణిజ్యం',
    3: 'వ్యాపారం',
    4: 'విద్య',
    5: 'జ్ఞానం',
    6: 'నైపుణ్యం',
    7: 'భాగస్వామ్య',
    8: 'పరిశోధన',
    9: 'తత్వం',
    10: 'నిపుణత',
    11: 'లాభం',
    12: 'విదేశం',
  },
  // Jupiter in houses 1-12
  4: {
    1: 'గురువు',
    2: 'సంపద',
    3: 'భ్రాతృ',
    4: 'సంతోషం',
    5: 'పుత్రులు',
    6: 'సేవ',
    7: 'వివాహం',
    8: 'దీర్ఘాయువు',
    9: 'భాగ్యం',
    10: 'గౌరవం',
    11: 'విజయం',
    12: 'మోక్షం',
  },
  // Venus in houses 1-12
  5: {
    1: 'సౌందర్యం',
    2: 'ధనం',
    3: 'కళ',
    4: 'వాహనం',
    5: 'ప్రేమ',
    6: 'శత్రువులు',
    7: 'జీవిత భాగస్వామి',
    8: 'సుఖం',
    9: 'అదృష్టం',
    10: 'ప్రతిష్ట',
    11: 'లాభం',
    12: 'విలాసం',
  },
  // Saturn in houses 1-12
  6: {
    1: 'కష్టం',
    2: 'పేదరికం',
    3: 'సోదరులు',
    4: 'భూమి',
    5: 'ఆలస్యం',
    6: 'శత్రుజయం',
    7: 'ఆలస్య వివాహం',
    8: 'దీర్ఘాయువు',
    9: 'న్యాయం',
    10: 'కఠిన పని',
    11: 'లాభం',
    12: 'మోక్షం',
  },
  // Rahu in houses 1-12
  7: {
    1: 'అభిలాష',
    2: 'అస్పష్టత',
    3: 'సాహసం',
    4: 'భ్రాంతి',
    5: 'అడ్డంకులు',
    6: 'విజయం',
    7: 'విదేశీయులు',
    8: 'మార్పు',
    9: 'విదేశీ ప్రయాణం',
    10: 'శక్తి',
    11: 'ఆశలు',
    12: 'ముక్తి',
  },
  // Ketu in houses 1-12
  8: {
    1: 'ఆధ్యాత్మికత',
    2: 'నష్టం',
    3: 'మార్పులు',
    4: 'అశాంతి',
    5: 'బుద్ధి',
    6: 'విజయం',
    7: 'విడిపోవుట',
    8: 'మోక్షం',
    9: 'తపస్సు',
    10: 'అకస్మాత్తు',
    11: 'లాభనష్టం',
    12: 'ముక్తి',
  },
};

/**
 * Full Telugu prediction messages for each planet in each house (1-12)
 * Copied from yexaaPanchang/lang/prediction_msgs_te.json -> planets_in_houses
 */
const PLANET_HOUSE_MESSAGES: Record<number, Record<number, string>> = {
  // Sun (సూర్య) in houses 1-12
  0: {
    1: 'బలమైన నైతిక స్వభావం, నీతి-మనస్సు, ఆశయం మరియు శక్తి పట్ల ప్రేమ, మంచి ఆరోగ్యం మరియు జీవశక్తి ద్వారా బాగా మద్దతునిస్తుంది.',
    2: 'ఇది చాలా అనుకూలమైన పరిస్థితి కాదు. అధికారులను కించపరచడం ద్వారా నష్టాలు సంభవిస్తాయి. వ్యాధిగ్రస్తమైన ముఖం కలిగి ఉంటారు.',
    3: 'వ్యక్తిని ధైర్యవంతం చేస్తుంది. మనస్సు ధనవంతంగా మరియు ప్రశాంతంగా, విజయవంతమవుతుంది.',
    4: 'ఈ కలయిక ఒక వ్యక్తిని సాధారణంగా సంతోషంగా మరియు మానసికంగా ఆందోళనకు గురిచేస్తుంది. అతను తిరుగుతూ ఉంటాడు.',
    5: 'ఈ కలయిక వ్యక్తికి పిల్లలు, ధనవంతులు మరియు ఆనందాన్ని దూరం చేస్తుంది. అతని జీవితం చిన్నదిగా ఉంటుంది.',
    6: 'బృహస్పతి గ్రహం ద్వారా బాధ నుండి ఉపశమనం పొందకపోతే గుండె-సమస్య లేదా తరచుగా ఛాతీ నొప్పిని సూచిస్తున్నందున శనిగ్రహం కోరదగినది కాదు.',
    7: 'దేశీయుడు అందంగా ఉంటాడు మరియు జుట్టు పల్చగా ఉంటాడు. అతనికి కొద్దిమంది స్నేహితులు ఉంటారు మరియు వ్యక్తులతో కలిసిపోవడానికి ఇబ్బంది పడతారు.',
    8: 'సూర్యుడు 8వ ఇంట్లో ఉచ్ఛస్థితిలో ఉంటే, స్థానికుడు దీర్ఘకాలం జీవిస్తాడు. అతను మనోహరంగా మరియు అనర్గళంగా మాట్లాడేవాడు.',
    9: 'స్థానికుడు అదృష్టవంతుడు మరియు శ్రేయస్సు కలిగి ఉంటాడు. అతనికి చాలా మంది పుత్రులు, స్నేహితులు మరియు బంధువులు ఉంటారు.',
    10: 'స్థానికుడు చేసే పనులన్నింటిలో విజయం సాధిస్తాడు. ధృడంగా, ఆనందంగా ఉంటాడు. పుత్రులు, వాహనాలు, కీర్తి, తెలివితేటలు, డబ్బు, అధికారం ఉంటుంది.',
    11: 'వ్యక్తి చాలా కాలం జీవించి ధనవంతుడు అవుతాడు. అతనికి భార్య, పిల్లలు మరియు అనేక మంది సేవకులు ఉంటారు.',
    12: 'స్థానికుడు అనైతిక జీవితాన్ని గడపవచ్చు మరియు నీచమైన వృత్తులలో నిమగ్నమై ఉండవచ్చు. అతను తన జీవితంలో పెద్దగా విజయం సాధించలేడు.',
  },
  // Moon (చంద్ర) in houses 1-12
  1: {
    1: 'స్థానికుడు ఫ్యాన్సీగా మరియు శృంగారభరితంగా ఉంటాడు, మితంగా తినేవాడు. గణనీయమైన చంచలత్వం సాధారణంగా తేలికగా సాగే స్వభావంతో నిగ్రహించబడుతుంది.',
    2: 'అతను పెద్ద కుటుంబాన్ని కలిగి ఉంటాడు మరియు చాలా ఆనందాన్ని అనుభవిస్తాడు. ఆడవారి ద్వారా కూడా డబ్బు లభిస్తుంది.',
    3: 'సాధారణంగా వృత్తిలో మార్పులు సూచించబడతాయి, ప్రయాణంలో ఇష్టం మరియు చురుకైన మనస్సు ఉంటుంది.',
    4: 'ఇంటిని కలిగి ఉంటాడు; బంధువుల నుండి ఆనందాన్ని పొందుతాడు; ఉల్లాసంగా మరియు సంతృప్తిగా ఉంటాడు.',
    5: 'మనస్సులో స్పష్టత, పిల్లల నుండి ఆనందం, భూములు, రత్నాలు మరియు విలువైన రాళ్లను పొందడం.',
    6: 'బాల్యంలో బాలారిష్టం లేదా చాలా అనారోగ్యాన్ని సూచిస్తుంది. కుజుడు మరియు శని ద్వారా బాధ: ఆసక్తికరమైన మరియు నయం చేయలేని వ్యాధులు.',
    7: 'స్థానికుడు ఉద్రేకపరుడు మరియు సులభంగా అసూయకు గురి అవుతాడు. స్థానికుడు చిన్నతనంలో తల్లి చనిపోవచ్చు.',
    8: '8వ స్థానంలో చంద్రుడు ఉన్న స్థానికుడు మానసిక వైకల్యానికి గురవుతాడు. అతను ఆందోళన చెందుతాడు మరియు మానసిక సమస్యలతో బాధపడుతుంటాడు.',
    9: 'స్థానికుడు అదృష్టవంతుడు మరియు శ్రేయస్సు కలిగి ఉంటాడు. అతనికి చాలా మంది పుత్రులు, స్నేహితులు మరియు బంధువులు ఉంటారు.',
    10: 'స్థానికుడు మతస్థుడు, ధనవంతుడు, తెలివైనవాడు మరియు ధైర్యంగా ఉంటాడు. అతను తన అన్ని ప్రయత్నాలలో విజయం సాధిస్తాడు.',
    11: 'ఒకడు శ్రేష్ఠుడు, ఉదారుడు మరియు ధనవంతుడు, భార్య మరియు పిల్లలతో ఆశీర్వదిస్తాడు.',
    12: 'స్థానికుడు కొంత వైకల్యంతో బాధపడవచ్చు. అతను సంకుచిత మనస్తత్వం, కఠిన హృదయం మరియు కొంటె స్వభావం కలిగి ఉంటాడు.',
  },
  // Mars (కుజ) in houses 1-12
  2: {
    1: 'ఇది వేడి రాజ్యాంగం, ధైర్యం, ఆత్మవిశ్వాసం మరియు వ్యాపారాన్ని ఇస్తుంది. స్థానికుడు ఆచరణాత్మక సామర్థ్యం మరియు స్వేచ్ఛ మరియు స్వాతంత్ర్యం యొక్క ప్రేమను కలిగి ఉంటాడు.',
    2: 'కలహాదారు అవుతాడు. మంచి సంపాదన శక్తులు ఉంటాడు, కానీ సాధారణంగా నీచంగా ఉంటాడు. చాలా డబ్బు కూడబెట్టుతాడు.',
    3: 'ఈ స్థానం సోదర సోదరీమణులకు చెడ్డది. ప్రయాణాల వల్ల ప్రమాదాలు మరియు ప్రమాదాలు ఉంటాయి.',
    4: 'ఇది సాధారణంగా చెడ్డ కలయిక. వ్యక్తికి తల్లి, బంధువులు మరియు స్నేహితుల నుండి ఆనందం దూరమవుతుంది.',
    5: 'అతని భార్య, స్నేహితులు మరియు పిల్లలకు దయనీయంగా ఉంటుంది; ఎల్లప్పుడూ ఆలోచనలలో కలవరపడుతుంది.',
    6: 'అధిక ఉద్వేగభరితుడు, విజయవంతమైనవాడు, పాలకుడిగా లేదా రాజకీయ నాయకుడిగా విజయం సాధించాడు.',
    7: 'దేశస్థుడు తన భార్యచే కోడి కోడి మరియు స్త్రీలకు లొంగిపోతాడు. వైవాహిక జీవితంలో గొడవలు మరియు ఉద్రిక్తతలు ఉంటాయి.',
    8: 'ఇతర ఉపశమన కారకాలు లేకుంటే స్థానికుడు స్వల్పకాలికంగా ఉంటాడు మరియు అతను భార్య (లేదా భర్త)ని కోల్పోవచ్చు.',
    9: 'స్థానికుడు అధికారాన్ని కలిగి ఉంటాడు మరియు ఐశ్వర్యవంతుడు అవుతాడు, అతను సంతానం కలిగి ఉంటాడు మరియు సంతోషంగా ఉంటాడు.',
    10: 'స్థానికులకు అనుకూలమైన ఇతర కలయికలు క్రూరమైన పాలకుడిగా మారవచ్చు. అతను ప్రశంసలను ఇష్టపడతాడు.',
    11: 'స్థానికుడు అనర్గళంగా మరియు శక్తివంతంగా మాట్లాడేవాడు, తెలివైనవాడు మరియు ధనవంతుడు, కానీ కామంగలవాడు.',
    12: 'వ్యక్తి తన భార్యను కోల్పోవచ్చు, అతను స్వార్థపరుడు, ద్వేషంతో ఉంటాడు మరియు శరీరంలో అధిక వేడి కారణంగా అతను రోగాలకు గురవుతాడు.',
  },
  // Mercury (బుధ) in houses 1-12
  3: {
    1: 'ఈ స్థానం విషయాన్ని హాస్యాస్పదంగా చేస్తుంది. తెలివితేటలు మరియు మానసిక చాతుర్యం బలంగా గుర్తించబడతాయి.',
    2: 'ధార్మిక మరియు తాత్విక శాస్త్రాలలో నేర్చుకుంటారు. ఉపన్యాసాలు, వ్యాపార మరియు వాణిజ్య వ్యవహారాల ద్వారా లాభాన్ని సూచిస్తుంది.',
    3: 'ఇతరుల ప్రయోజనం కోసం మంచి పనులు చేస్తాడు, కానీ అతను సంతోషంగా లేడు. మనస్సు పదునైనది.',
    4: 'విద్యావేత్తగా లేదా దౌత్యవేత్తగా మెరుస్తాడు. అతను ప్రభుత్వాన్ని ధైర్యంగా విమర్శిస్తాడు.',
    5: 'నేర్చుకుని సంతోషంగా ఉంటారు, చాలా మంది పిల్లలను కలిగి ఉంటారు. వ్యక్తి సలహాదారు లేదా మంత్రి కావచ్చు.',
    6: 'వివాదాలు, ప్రదర్శనలు ఉన్నప్పటికీ గౌరవం; చదువుకు అంతరాయం.',
    7: 'ధర్మం మరియు తెలివిగల వ్యక్తి, అతను చక్కగా మరియు రుచిగా దుస్తులు ధరించేవాడు.',
    8: 'బుధుడు 8వ స్థానంలో ఉన్నప్పుడు, స్థానికుడు చాలా మంచి లక్షణాలను కలిగి ఉంటాడు. అతను తన సంతానోత్పత్తికి మరియు మర్యాదపూర్వక ప్రవృత్తికి ప్రసిద్ధి చెందుతాడు.',
    9: 'స్థానికుడు చాలా విద్య మరియు సంపదను పొందుతాడు, అతను గొప్ప పండితుడు, అతను తెలివిగలవాడు.',
    10: 'అతను సంతోషంగా మరియు ముక్కుసూటి వ్యక్తిగా ఉంటాడు. అతను అనేక విషయాలలో పండితుడు మరియు మరింత జ్ఞానం మరియు కీర్తిని పొందడంలో నిమగ్నమై ఉంటాడు.',
    11: 'ఒకడు అనేక శాస్త్రాలలో నేర్చుకుంటాడు. అతను చురుకైన మరియు పదునైన తెలివిని కలిగి ఉంటాడు, ధనవంతుడు, సత్యవంతుడు మరియు సంతోషంగా ఉంటాడు.',
    12: 'మోజుకనుగుణంగా మరియు అవిధేయుడిగా, వ్యక్తి వివాహేతర సంబంధాలలో మునిగిపోతాడు మరియు కష్టాలను అనుభవిస్తాడు.',
  },
  // Jupiter (గురు) in houses 1-12
  4: {
    1: 'స్థానికుడికి అయస్కాంత వ్యక్తిత్వం ప్రసాదించబడుతుంది. ఆశావాద స్ఫూర్తి, ఉల్లాస స్వభావం మరియు ఆహ్లాదకరమైన మర్యాదలు సూచించబడతాయి.',
    2: 'కవి, గొప్ప రచయిత, జ్యోతిష్కుడు లేదా శాస్త్రవేత్త కూడా అవుతాడు. విజయావకాశాలను పెంచుతాడు.',
    3: 'ఇది కూడా మంచి స్థానమే. మనస్సు ఆశావాదం మరియు తాత్వికమైనది. చాలా మంది మంచి సోదరులను కలిగి ఉంటారు.',
    4: 'తాత్వికంగా మొగ్గు, నేర్చుకున్న, సంతోషంగా, పాలకవర్గం యొక్క అనుగ్రహాన్ని కలిగి ఉంటాడు.',
    5: 'తర్కం మరియు చట్టం, మంత్రశాస్త్రం, అత్యంత తెలివైనవాడు, బోధకుడు లేదా రాజుకు సలహాదారుడు.',
    6: 'క్రియారహితుడు, అగౌరవానికి గురవుతాడు, మంత్రతంత్రంలో మునిగిపోతాడు, శత్రువులచే భయపడతాడు, దురదృష్టవంతుడు.',
    7: 'దౌత్య మరియు దయగల వ్యక్తికి సద్గుణవంతురాలు, మంచి రూపం మరియు పవిత్రమైన భార్య లభిస్తుంది.',
    8: 'స్థానికుడు సంతోషంగా లేడు, కానీ ఉదార హృదయంతో ఉంటాడు, అతను చాలా కాలం జీవిస్తాడు.',
    9: 'స్థానికుడు చట్టం, తత్వశాస్త్రం మొదలైనవాటికి ఘాతాంకారంగా మారవచ్చు. బృహస్పతి ప్రయోజనకరమైన గ్రహాల దృష్టిలో ఉంటే అతను చాలా స్థిరమైన ఆస్తిని పొందుతాడు.',
    10: 'స్థానికుడు ప్రభుత్వంలో ఉన్నత అధికారిగా ఉంటాడు. ధనవంతుడు, ధర్మవంతుడు, ఆధ్యాత్మిక లేదా మతపరమైన జీవితంలో స్థిరమైనవాడు.',
    11: 'స్థానికుడు దీర్ఘాయువు కలిగి ఉంటాడు. పరిమిత సంఖ్యలో సమస్యలు కలిగి ఉంటాడు, ధైర్యవంతుడు మరియు ధైర్యవంతుడు.',
    12: 'స్థానికుడు మతాన్ని అవహేళన చేయవచ్చు మరియు చెడు మనస్తత్వం కలిగి ఉంటాడు. అతను భయంకరమైన పనులు చేస్తాడు.',
  },
  // Venus (శుక్ర) in houses 1-12
  5: {
    1: 'ఇది అదృష్ట కలయిక, లగ్నస్థుడు మకరం లేదా కుంభరాశి అయినట్లయితే. స్థానికుడు స్నేహశీలత మరియు ప్రకృతి యొక్క భావోద్వేగ వైపు స్పందించే ఉల్లాసమైన స్వభావాన్ని కలిగి ఉంటాడు.',
    2: 'పెద్ద కుటుంబం. డబ్బు సాధారణంగా ఇతరుల ఆదరాభిమానాల వల్ల వస్తుంది. మంచి ఆహారం తింటారు, వస్తువులను కలిగి ఉంటారు.',
    3: 'మానసిక నాణ్యత బాగానే ఉంటుంది, కానీ ఆరోగ్యం బలహీనంగా ఉంటుంది, జీవశక్తి లోపిస్తుంది.',
    4: 'సంగీతంలో మంచి ప్రావీణ్యం, మెరుగులు దిద్దిన మర్యాదలు, తల్లితో గాఢమైన అనుబంధం.',
    5: 'కవిత; చాలా మంది స్నేహితులు మరియు అందమైన పిల్లలను కలిగి ఉంటారు; సంతానం ద్వారా ఆనందం.',
    6: 'శత్రువులు లేరు, యువతులచే పాడు చేయబడినవారు, స్త్రీల నుండి అనుగ్రహం పొందేందుకు అనుకూలం.',
    7: 'కలహాలు, ఇంద్రియాలు మరియు ఉద్వేగభరితమైన, స్థానిక వ్యక్తికి అనారోగ్యకరమైన అలవాట్లు ఉన్నాయి.',
    8: '8వ స్థానంలో ఉన్న శుక్రుని స్థానం చాలా శుభాలను ఇస్తుంది. స్థానికుడు చాలా సంపదతో వస్తాడు.',
    9: 'స్థానికుడు అదృష్టవంతుడు మరియు కీర్తి, అభ్యాసం, పిల్లలు, భార్య మరియు సాధారణంగా అన్ని రకాల ఆనందాలను కలిగి ఉంటాడు.',
    10: 'స్థానికుడు ఇళ్ళు మరియు భవనాల ద్వారా సంపాదిస్తాడు. అతను చాలా ప్రభావశీలుడు.',
    11: 'అతను సంచరించే స్వభావం కలిగి ఉంటాడు, అన్ని రకాల సుఖాలు మరియు విలాసాలు కలిగి అపారమైన లాభాలు పొందుతాడు.',
    12: 'బంధువులను విడిచిపెట్టడం; విజయం మరియు శ్రమ లేకుండా సుఖాల కోసం తహతహలాడడం స్థానికుని జీవితాన్ని దుర్భరం చేస్తుంది.',
  },
  // Saturn (శని) in houses 1-12
  6: {
    1: 'విదేశీ ఆచారాలు సులభంగా కాపీ చేయబడతాయి మరియు అనుకరించబడతాయి. కానీ, శని బాధించకపోతే, క్షేమం లేదా ఇతరుల పట్ల చాలా శ్రద్ధ ఉంటుంది.',
    2: 'శని, రెండవది తులారాశి, మకరం లేదా కుంభరాశి అయితే తప్ప, సంపాదన కోసం కష్టపడతారు. ఎక్కువ పని తక్కువ లాభంతో ఉంటుంది.',
    3: 'ధైర్యవంతుడు మరియు ధైర్యవంతుడు, ధనవంతుడు, సోదరులను కోల్పోవడం, విపరీతమైన మరియు క్రూరత్వం.',
    4: 'ప్రారంభ సంవత్సరాలలో అనారోగ్యం; తల్లిని కోల్పోయింది మరియు సంతోషంగా ఉండదు; గాలులతో మరియు కఫం ఫిర్యాదులతో బాధపడుతున్నారు.',
    5: 'దుర్మార్గుడు మరియు మూర్ఖుడు; అనారోగ్యం మరియు బలహీనుడు; పేదవాడు మరియు ఇతరులు అసహ్యించుకుంటారు.',
    6: 'తగాదాలు, మొండి పట్టుదలగల, ఆత్రుతగా తినేవాడు, శత్రుత్వం లేనివాడు, ధైర్యవంతుడు.',
    7: 'స్థానికుడు భార్య నియంత్రణలో ఉంటాడు. భార్య వికారమైనది లేదా హంచ్ బ్యాక్‌డ్‌గా ఉంటుంది.',
    8: '8వ ఇంట్లో శని మంచి దీర్ఘాయువును ఇస్తాడు, కానీ జీవితంలో చాలా బాధ్యతలను కలిగి ఉంటాడు.',
    9: 'స్థానికుడు ఒంటరి జీవితాన్ని గడుపుతాడు మరియు వివాహం చేసుకోకపోవచ్చు. అతను యుద్ధరంగంలో తన పరాక్రమానికి ప్రసిద్ధి చెందుతాడు.',
    10: 'స్థానికుడు పాలకుడు లేదా మంత్రి అవుతాడు. అతను వ్యవసాయదారుడు, ధైర్యవంతుడు, ధనవంతుడు మరియు ప్రసిద్ధుడు అవుతాడు.',
    11: 'స్థానికుడు చాలా మంది స్త్రీపురుషులను నియమించడం ద్వారా సంపాదిస్తాడు. అతనికి కొద్దిమంది స్నేహితులు ఉంటారు.',
    12: 'స్థానికుడు నీరసంగా ఉంటాడు మరియు అతని ధనాన్ని పోగొట్టుకుంటాడు. అతను మెల్లకన్ను కలిగి ఉంటాడు.',
  },
  // Rahu (రాహు) in houses 1-12
  7: {
    1: 'వైద్య పద్ధతుల ద్వారా కాకుండా ఇతర చికిత్స కోసం ఆరోగ్యం సాధారణంగా సంతృప్తికరంగా ఉండదు.',
    2: 'కష్టం, వ్యాధిగ్రస్తమైన ముఖం, కుటుంబ జీవితంలో రాపిడి, కంటి చూపు ప్రమాదం.',
    3: 'బయటకు కనిపించే ధైర్యవంతుడు. ఆకస్మిక మరియు ఊహించని వార్తలు.',
    4: 'ప్రవర్తనలో మూర్ఖత్వం; కొద్దిమంది స్నేహితులు; మోసానికి గురవుతారు.',
    5: 'కోలిక్‌తో బాధపడుతుంటాడు; ఇతరులచే పొరపాటున మరియు స్నేహం చేయబడలేదు.',
    6: 'దీర్ఘాయుష్షు, ధనవంతుడు, శత్రు, ప్రేత, రోగాల వల్ల ఆంతరంగిక రోగాల బారిన పడతాడు.',
    7: 'స్వదేశీ స్త్రీ అయితే కుటుంబానికి చెడ్డపేరు తెస్తుంది. అతను అసాధారణంగా మరియు భిన్నత్వంతో ఉంటాడు.',
    8: 'స్థానికుడు ప్రజల దూషణలు మరియు అవమానాలకు గురవుతాడు. అతను అనేక రుగ్మతలతో బాధపడుతాడు.',
    9: 'స్థానికుడికు వేధించే మరియు ఆధిపత్యం వహించే భార్య ఉంటుంది. అతను మర్యాద లేనివాడు మరియు లోపభూయిష్టంగా ఉంటాడు.',
    10: 'వితంతువుల పట్ల వ్యామోహ ధోరణి ఉంది. అతను కవిత్వం మరియు సాహిత్యంలో నైపుణ్యం కలిగిన కళాకారుడు అవుతాడు.',
    11: 'దేశస్థుడు సైన్యం లేదా నౌకాదళంలో తనకంటూ ప్రత్యేకతను కలిగి ఉంటాడు, ప్రసిద్ధుడు, ధనవంతుడు మరియు విద్యావంతుడు అవుతాడు.',
    12: 'స్థానికుడు సంపన్నుడు, అనైతికత కలిగి ఉంటాడు, కానీ సహాయం చేసే స్వభావం కలిగి ఉంటాడు.',
  },
  // Ketu (కేతు) in houses 1-12
  8: {
    1: 'మానసిక శక్తులు అవకాశం ఉంది. ఇది బలహీనమైన రాజ్యాంగాన్ని మరియు బలహీనమైన వ్యక్తిని సూచిస్తుంది.',
    2: 'చెడ్డ వక్త. మోసం మరియు మోసం ద్వారా నష్టం. ఆర్థిక వ్యవహారాలలో బాధ్యత ఉంటుంది.',
    3: 'బలమైన మరియు సాహసోపేతమైన కానీ ఫంకీ. భ్రాంతులతో మనస్సును కలవరపరుస్తుంది.',
    4: 'తల్లి, ఆస్తులు మరియు ఆనందాన్ని కోల్పోతారు; విదేశీ ప్రదేశంలో నివసిస్తున్నారు.',
    5: 'పిల్లలను కోల్పోవడం; కడుపులో ఇబ్బంది, భావోద్వేగాలు మరియు భావాలకు సంబంధించి వింత మరియు విచిత్రమైన అనుభవాలు.',
    6: 'జాతకంలో కేతువు ఆక్రమించడానికి ఉత్తమ స్థానం. వ్యక్తికి కీర్తి మరియు అధికారం ఉంటుంది.',
    7: 'దేశస్థుడు తెలివిగల భార్యతో సంతోషంగా లేని వివాహాన్ని కలిగి ఉంటాడు. అతను ఉద్రేకపరుడు, పాపాత్ముడు.',
    8: '8వ స్థానంలో ఉన్న కేతువు లాభదాయకంగా ఉంటే, స్థానికుడు చాలా ధనాన్ని అనుభవిస్తాడు మరియు దీర్ఘకాలం జీవిస్తాడు.',
    9: 'స్థానికుడు చిన్నబుద్ధి కలవాడు మరియు చిన్న విషయాలపై కలత చెందుతాడు. అతను అనర్గళంగా ఉంటాడు.',
    10: 'స్థానికుడు బలవంతుడు, ధైర్యవంతుడు మరియు ప్రసిద్ధుడు. అతను నీచమైన పనులను చేస్తాడు.',
    11: 'స్థానికుడికి నిల్వ చేసే అలవాటు ఉంటుంది. అతను లాటరీ, గుర్రపు పందెం మరియు స్టాక్ ఎక్స్ఛేంజ్ వంటి ఊహాగానాల ద్వారా ద్రవ్య పతనాన్ని పొందగలడు.',
    12: 'స్థానికుడు చంచలమైన మరియు సంచరించే మనస్సు కలిగి ఉంటాడు మరియు అతను పుట్టిన దేశాన్ని విడిచిపెడతాడు.',
  },
};

/**
 * Calculate relative house number from a given Lagna
 * @param lagnaRashi - The rashi considered as Lagna (0-11)
 * @param planetRashi - The rashi where planet is placed (0-11)
 * @returns House number (1-12) relative to lagna
 */
function getRelativeHouse(lagnaRashi: number, planetRashi: number): number {
  const diff = (planetRashi - lagnaRashi + 12) % 12;
  return diff + 1; // Houses are 1-based (1-12)
}

/**
 * Get prediction keyword for a planet in a specific house
 */
function getPlanetHouseKeyword(planetIndex: number, house: number): string {
  if (planetIndex < 0 || planetIndex > 8) return '';
  if (house < 1 || house > 12) return '';

  return PLANET_HOUSE_KEYWORDS[planetIndex]?.[house] || 'సాధారణం';
}

/**
 * Combine predictions from all planets for a rashi
 * Simple logic: prioritize benefic planets (Jupiter, Venus, Mercury, Moon in bright fortnight)
 */
function combinePredictions(
  planetPredictions: Array<{ planet: string; keyword: string; house: number }>
): string {
  if (planetPredictions.length === 0) return 'సాధారణం';

  // Priority order: Jupiter > Venus > Mercury > Moon > others
  const priorityPlanets = ['Jupiter', 'Venus', 'Mercury', 'Moon'];

  for (const priority of priorityPlanets) {
    const found = planetPredictions.find(p => p.planet === priority);
    if (found) {
      // Benefics in 1,4,5,7,9,10,11 are good
      if ([1, 4, 5, 7, 9, 10, 11].includes(found.house)) {
        return found.keyword;
      }
    }
  }

  // If no benefic in good house, return first planet's keyword
  return planetPredictions[0]?.keyword || 'సాధారణం';
}

/**
 * Get most significant full message prediction for a rashi
 * Uses same priority logic as combinePredictions
 */
function getMostSignificantMessage(
  planetPredictions: Array<{ planet: string; message?: string; house: number }>
): string {
  if (planetPredictions.length === 0) return 'సాధారణం';

  // Priority order: Jupiter > Venus > Mercury > Moon > others
  const priorityPlanets = ['Jupiter', 'Venus', 'Mercury', 'Moon'];

  for (const priority of priorityPlanets) {
    const found = planetPredictions.find(p => p.planet === priority);
    if (found && found.message) {
      // Benefics in 1,4,5,7,9,10,11 are good
      if ([1, 4, 5, 7, 9, 10, 11].includes(found.house)) {
        return found.message;
      }
    }
  }

  // If no benefic in good house, return first planet's message
  return planetPredictions[0]?.message || 'సాధారణం';
}

/**
 * Calculate predictions for all 12 rashis based on current planetary positions
 * @param grahas - Array of planetary positions from RashiChart
 * @param mode - 'singleWord' or 'fullMessage'
 * @returns Array of predictions for all 12 rashis
 */
export function calculateRashiPredictions(
  grahas: GrahaRashiInfo[],
  mode: PredictionMode = 'singleWord'
): RashiPredictionResult[] {
  const results: RashiPredictionResult[] = [];

  // For each rashi as Lagna
  for (let rashi = 0; rashi < 12; rashi++) {
    const planetPredictions: Array<{
      planet: string;
      house: number;
      keyword?: string;
      message?: string;
    }> = [];

    // Calculate where each planet falls relative to this rashi
    grahas.forEach((graha, planetIndex) => {
      if (planetIndex >= 9) return; // Only first 9 planets (Sun to Ketu)

      const planetRashi = graha.rashiIndex;
      const relativeHouse = getRelativeHouse(rashi, planetRashi);
      const keyword = getPlanetHouseKeyword(planetIndex, relativeHouse);
      const fullMessage = PLANET_HOUSE_MESSAGES[planetIndex]?.[relativeHouse] || '';

      planetPredictions.push({
        planet: PLANET_NAMES[planetIndex],
        house: relativeHouse,
        keyword: mode === 'singleWord' ? keyword : undefined,
        message:
          mode === 'fullMessage'
            ? fullMessage || `${PLANET_NAMES_TE[planetIndex]} ${relativeHouse}వ భావంలో - ${keyword}`
            : undefined,
      });
    });

    // Combine predictions for this rashi
    const combinedPrediction =
      mode === 'singleWord'
        ? combinePredictions(
            planetPredictions.map(p => ({ planet: p.planet, keyword: p.keyword!, house: p.house }))
          )
        : getMostSignificantMessage(planetPredictions);

    results.push({
      rashi,
      rashiName: RASHI_NAMES_TE[rashi],
      prediction: combinedPrediction,
      planets: planetPredictions,
    });
  }

  return results;
}

/**
 * Get prediction for a specific rashi
 */
export function getPredictionForRashi(
  grahas: GrahaRashiInfo[],
  rashi: number,
  mode: PredictionMode = 'singleWord'
): RashiPredictionResult | null {
  if (rashi < 0 || rashi > 11) return null;

  const predictions = calculateRashiPredictions(grahas, mode);
  return predictions[rashi];
}
